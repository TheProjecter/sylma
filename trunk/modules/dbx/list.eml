<?xml version="1.0" encoding="utf-8"?>
<le:action xmlns:le="http://www.sylma.org/execution" xmlns:li="http://www.sylma.org/interface" xmlns="http://www.w3.org/1999/xhtml">
  <le:settings>
    <le:name>Liste</le:name>
    <le:argument format="XML_Document" name="model"/>
    <le:argument format="php-string" name="module"/>
    <le:argument format="php-string" name="headers"/>
    <le:argument name="xquery-headers" format="php-array"/>
    <le:document set-variable="datas">
      <le:xquery>
        <le:get-argument name="xquery-headers"/>
        <le:argument le:parse-variables="true"><![CDATA[let $page := [$page]
let $pageSize := [$page-size]
let $start:=(($page*$pageSize) - $pageSize)

let $result := (
  for $el in /*/[$parent]/*
    order by xs:date($el/[$order]) descending
  return $el)

let $pageTotal := ceiling((count($result) div $pageSize))

return
  <[$parent] total="{$pageTotal}" page="{$page}">
    {subsequence($result, ($start + 1), ($start + $pageSize))}
  </[$parent]>]]></le:argument>
      </le:xquery>
    </le:document>
  </le:settings>
  <table class="list">
    <le:get-argument name="model">
      <li:parse>
        <le:template path="headers.xsl">
          <li:set-parameter>
            <le:argument>module</le:argument>
            <le:get-argument name="module"/>
          </li:set-parameter>
          <li:set-parameter>
            <le:argument>headers</le:argument>
            <le:get-argument name="headers"/>
          </li:set-parameter>
        </le:template>
      </li:parse>
    </le:get-argument>
    <le:get-variable name="datas">
      <li:parse>
        <le:template path="list.xsl">
          <li:set-parameter>
            <le:argument>module</le:argument>
            <le:get-argument name="module"/>
          </li:set-parameter>
          <li:set-parameter>
            <le:argument>headers</le:argument>
            <le:get-argument name="headers"/>
          </li:set-parameter>
        </le:template>
      </li:parse>
    </le:get-variable>
  </table>
</le:action>
